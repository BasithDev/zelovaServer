import{r as l,j as e,bV as Y,B as i,bW as U,bX as V,bY as k,bZ as $,b_ as W,P as c,b$ as X,c0 as Z,E as G,m as I,c1 as H}from"./index-CYBSKVP3.js";import{P as S}from"./PrimaryBtn-C9AhwixI.js";import{c as O}from"./index-B6PFVwOa.js";import{l as J}from"./cropper-CnBa9Gml.js";import{u as K}from"./uploadImageToCloud-DIGDbQWH.js";import{B as ee}from"./BeatLoader-B-jdWoa4.js";const te=()=>{const[a,u]=l.useState(""),[d,x]=l.useState([]),[m,p]=l.useState(""),[f,v]=l.useState(""),g=async()=>{var t;try{let C=(await Y()).data.categories;x(C||[])}catch(r){console.log(((t=r.response)==null?void 0:t.data)||r.message)}};l.useEffect(()=>{g()},[]);const b=async()=>{if(!a.trim()){i.error("Category name is required.");return}try{const t=await U({name:a});i.success(t.message||"Category added successfully."),u(""),g()}catch(t){console.log(t.response.data)}},j=async()=>{var t,r,C;if(!m){i.error("Please select a main category.");return}if(!f.trim()){i.error("Subcategory name is required.");return}try{const N=await V({name:f,categoryName:m});i.success(N.message||"Subcategory added successfully."),v(""),window.dispatchEvent(new Event("updateDropdownData"))}catch(N){console.log(((t=N.response)==null?void 0:t.data)||N.message),i.error(((C=(r=N.response)==null?void 0:r.data)==null?void 0:C.message)||"Failed to add subcategory.")}};return e.jsxs("div",{className:"bg-white shadow-lg rounded-lg p-4 sm:p-8 max-w-5xl mx-auto space-y-4 sm:space-y-6",children:[e.jsx("h2",{className:"text-xl sm:text-3xl font-bold text-gray-800 mb-2 sm:mb-4",children:"Food Categories Management"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"flex flex-col space-y-3 sm:space-y-4",children:[e.jsx("label",{className:"text-base sm:text-lg font-medium text-gray-700",children:"Add Main Food Category"}),e.jsx("input",{type:"text",className:"text-base sm:text-xl p-2 sm:p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Enter main category",value:a,onChange:t=>u(t.target.value)}),e.jsx(S,{text:"Add Main Category",onClick:b,className:"w-full sm:w-auto px-4 sm:px-6 py-2 sm:py-3 text-base sm:text-xl font-semibold text-white bg-orange-500 rounded-md hover:bg-orange-600 transition-colors"})]}),e.jsxs("div",{className:"flex flex-col space-y-3 sm:space-y-4",children:[e.jsx("label",{className:"text-base sm:text-lg font-medium text-gray-700",children:"Select Main Food Category"}),e.jsxs("select",{value:m,onChange:t=>p(t.target.value),className:"text-base sm:text-xl p-2 sm:p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:[e.jsx("option",{value:"",children:"Select a category"}),d.map(t=>e.jsx("option",{value:(t==null?void 0:t.name)||"loading...",children:(t==null?void 0:t.name)||"loading.."},t==null?void 0:t._id))]}),e.jsx("label",{className:"text-base sm:text-lg font-medium text-gray-700",children:"Add Subcategory"}),e.jsx("input",{type:"text",className:"text-base sm:text-xl p-2 sm:p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Enter subcategory",value:f,onChange:t=>v(t.target.value)}),e.jsx(S,{text:"Add Subcategory",onClick:j,className:"w-full sm:w-auto px-4 sm:px-6 py-2 sm:py-3 text-base sm:text-xl font-semibold text-white bg-orange-500 rounded-md hover:bg-orange-600 transition-colors"})]})]})]})},se=()=>{const[a,u]=l.useState(""),[d,x]=l.useState(""),[m,p]=l.useState(""),[f,v]=l.useState([]),g=l.useCallback(async()=>{try{const t=await k();v(t.data.offers)}catch(t){console.error("Error fetching offers:",t),i.error("Failed to fetch offers. Please try again.")}},[]);l.useEffect(()=>{g()},[g]);const b=async()=>{if(!a||!d||!m){i.error("All fields are required!");return}if(d<=0||m<0){i.error("Invalid quantity or discount amount!");return}try{await $({offerName:a,requiredQuantity:d,discountAmount:m}),i.success("Offer added successfully!"),u(""),x(""),p(""),g(),window.dispatchEvent(new Event("updateDropdownData"))}catch(t){console.error("Error adding offer:",t),i.error("Failed to add offer. Please try again.")}},j=async t=>{try{const r=await W(t);i.success(r.data.message),g()}catch(r){console.log(r)}};return e.jsxs("div",{className:"bg-white shadow-lg rounded-lg p-4 sm:p-8 max-w-5xl mx-auto space-y-4 sm:space-y-6",children:[e.jsx("h2",{className:"text-xl sm:text-3xl font-bold text-gray-800 mb-2 sm:mb-4",children:"Offer Management"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"flex flex-col space-y-2 sm:space-y-3",children:[e.jsx("label",{className:"text-base sm:text-lg font-medium text-gray-700",children:"Offer Name"}),e.jsx("input",{type:"text",className:"text-base sm:text-xl p-2 sm:p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Enter offer name",value:a,onChange:t=>u(t.target.value)})]}),e.jsxs("div",{className:"flex flex-col space-y-2 sm:space-y-3",children:[e.jsx("label",{className:"text-base sm:text-lg font-medium text-gray-700",children:"Required Quantity"}),e.jsx("input",{type:"number",className:"text-base sm:text-xl p-2 sm:p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Enter required quantity",value:d,onChange:t=>x(t.target.value)})]}),e.jsxs("div",{className:"flex flex-col space-y-2 sm:space-y-3",children:[e.jsx("label",{className:"text-base sm:text-lg font-medium text-gray-700",children:"Discount Amount"}),e.jsx("input",{type:"number",className:"text-base sm:text-xl p-2 sm:p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Enter discount amount",value:m,onChange:t=>p(t.target.value)})]}),e.jsx("div",{className:"col-span-1 md:col-span-2",children:e.jsx(S,{text:"Add Offer",onClick:b,className:"w-full py-2 sm:py-3 px-4 sm:px-6 text-base sm:text-xl font-semibold text-white bg-orange-500 rounded-md hover:bg-orange-600 transition-colors"})})]}),e.jsxs("div",{className:"mt-6 sm:mt-8",children:[e.jsx("h3",{className:"text-lg sm:text-2xl font-bold text-gray-800 mb-3 sm:mb-4",children:"Available Offers"}),e.jsx("div",{className:"bg-gray-50 p-4 sm:p-6 rounded-lg shadow-md space-y-3 sm:space-y-4",children:f.length>0?f.map(t=>e.jsxs("div",{className:"flex hover:scale-[1.02] cursor-pointer hover:shadow-lg transition-all duration-200 justify-between items-center p-3 sm:p-4 bg-white rounded-lg shadow",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-base sm:text-xl font-semibold text-gray-800",children:t.offerName}),e.jsxs("p",{className:"text-sm sm:text-base text-gray-600",children:["Quantity: ",t.requiredQuantity," | Discount: ",t.discountAmount,"%"]})]}),e.jsx("button",{className:"text-red-500 text-sm sm:text-lg font-semibold hover:text-white hover:bg-red-500 transition-all duration-200 px-2 py-1 rounded-md",onClick:()=>j(t._id),children:"Delete"})]},t._id)):e.jsx("p",{className:"text-base sm:text-lg text-gray-600",children:"No offers available."})})]})]})},h=({label:a,type:u="text",name:d,value:x,onChange:m,placeholder:p,options:f,isSelect:v})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-base sm:text-lg font-medium text-gray-700 mb-2",children:a}),v?e.jsx("select",{name:d,value:x,onChange:m,className:"w-full text-base sm:text-xl p-2 sm:p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",children:f.map((g,b)=>e.jsx("option",{value:g.value,children:g.label},b))}):u==="textarea"?e.jsx("textarea",{name:d,value:x,onChange:m,className:"w-full text-base sm:text-xl p-2 sm:p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",rows:"4",placeholder:p}):e.jsx("input",{type:u,name:d,value:x,onChange:m,className:"w-full text-base sm:text-xl p-2 sm:p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:p})]});h.propTypes={label:c.string,type:c.oneOf(["text","number","email","password","textarea"]),name:c.string,value:c.oneOfType([c.string,c.number]),onChange:c.func,placeholder:c.string,options:c.arrayOf(c.shape({value:c.oneOfType([c.string,c.number]).isRequired,label:c.string})),isSelect:c.bool};const de=()=>{const[a,u]=l.useState({itemName:"",price:"",description:"",category:"",offer:"",isCustomizable:!1,customFields:[],image:null}),[d,x]=l.useState(null),[m,p]=l.useState(!1),[f,v]=l.useState({subCategories:[],offers:[]}),[g,b]=l.useState(!1),j=l.useRef(null),t=l.useCallback(async()=>{try{const[s,o]=await Promise.all([X(),k()]);v({subCategories:s.data.subCategories||[],offers:o.data.offers||[]})}catch(s){console.error("Error fetching dropdown data:",s)}},[]);l.useEffect(()=>{t()},[t]),l.useEffect(()=>{const s=()=>{t()};return window.addEventListener("updateDropdownData",s),()=>{window.removeEventListener("updateDropdownData",s)}},[t]);const r=(s,o)=>{u(n=>({...n,[s]:o}))},C=s=>{r("isCustomizable",s==="Yes"),s==="No"&&r("customFields",[])},N=()=>{u(s=>({...s,customFields:[...s.customFields,{fieldName:"",options:"",price:""}]}))},E=(s,o,n)=>{const y=a.customFields.map((F,w)=>w===s?{...F,[o]:n}:F);r("customFields",y)},P=s=>{const o=a.customFields.filter((n,y)=>y!==s);r("customFields",o)},R=s=>{const o=s.target.files[0];if(o){const n=new FileReader;n.onloadend=()=>{r("image",n.result),b(!0)},n.readAsDataURL(o)}},q=()=>{b(!1),r("image",null),x(null)},z=()=>{if(j.current){const s=j.current.cropper.getCroppedCanvas().toDataURL();x(s),b(!1)}},_=()=>{const{itemName:s,price:o,category:n,customFields:y}=a;if(!s||!o||!n||!d)return i.error("Please fill in all required fields!"),!1;if(y&&y.length>0)for(let F of y){const{fieldName:w,options:A,price:D}=F;if(!w||!A||!D)return i.error(`Custom field "${w||"Unnamed"}" is incomplete!`),!1;const L=A.split(","),Q=D.split(",");if(L.length!==Q.length)return i.error(`Custom field "${w}" has mismatched options and prices!`),!1}return!0},B=async s=>{if(s.preventDefault(),_())try{p(!0);const o=await K(d),n={...a,image:o.secure_url},y=await H(n);i.success(y.data.message),u({itemName:"",price:"",description:"",category:"",offer:"",isCustomizable:!1,customFields:[],image:null}),x(null)}catch(o){i.error("Failed to add product!"),console.error("Add Product Error:",o)}finally{p(!1)}},{subCategories:M,offers:T}=f;return e.jsxs("div",{className:"min-h-screen bg-gray-50 py-6 sm:py-10 px-3 sm:px-4",children:[e.jsxs("div",{className:"space-y-6 sm:space-y-8",children:[e.jsx("h1",{className:"text-center font-bold text-3xl sm:text-5xl",children:"Add Items"}),e.jsx(te,{}),e.jsx(se,{}),e.jsxs("div",{className:"bg-white shadow-lg rounded-lg p-4 sm:p-8 max-w-5xl mx-auto space-y-6 sm:space-y-8",children:[e.jsx("h3",{className:"text-2xl sm:text-3xl font-bold text-gray-800 mb-4",children:"Add New Food Item"}),e.jsxs("form",{className:"space-y-6 sm:space-y-8",children:[e.jsx(h,{label:"Item Name",placeholder:"Enter item name",value:a.itemName,onChange:s=>r("itemName",s.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-base sm:text-lg font-medium text-gray-700 mb-2",children:"Add Item Images"}),e.jsxs("div",{className:"flex flex-wrap gap-4 mt-4",children:[d?e.jsxs("div",{className:"relative w-full sm:w-52 h-48 sm:h-60 border border-gray-300 rounded-md flex items-center justify-center group",children:[e.jsx("img",{src:d,alt:"Cropped",className:"w-full h-full object-cover rounded-md"}),e.jsx(Z,{onClick:()=>document.getElementById("image-upload").click(),className:"cursor-pointer text-3xl sm:text-4xl p-1 bottom-2 right-2 text-white absolute rounded-full bg-green-500 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-all duration-200"})]}):e.jsx("div",{onClick:()=>document.getElementById("image-upload").click(),className:"w-full sm:w-32 h-32 border border-gray-300 rounded-md flex items-center justify-center text-2xl text-gray-400 cursor-pointer",children:"+"}),e.jsx("input",{type:"file",className:"hidden",id:"image-upload",onChange:R,accept:"image/*"})]})]}),e.jsx(h,{label:"Item Price",type:"number",placeholder:"Enter item price",value:a.price,onChange:s=>r("price",s.target.value)}),e.jsx(h,{label:"Item Description",type:"textarea",placeholder:"Enter item description",value:a.description,onChange:s=>r("description",s.target.value)}),e.jsx(h,{label:"Select Food Item Category",isSelect:!0,options:[{value:"",label:"Select a category"},...M.map(s=>({value:s._id,label:s.name}))],value:a.category,onChange:s=>r("category",s.target.value)}),e.jsx(h,{label:"Select Offer Type",isSelect:!0,options:[{value:"",label:"Select an offer"},...T.map(s=>({value:s._id,label:s.offerName}))],value:a.offer,onChange:s=>r("offer",s.target.value)}),e.jsx(h,{label:"Customizable",isSelect:!0,options:[{value:"No",label:"No"},{value:"Yes",label:"Yes"}],value:a.isCustomizable?"Yes":"No",onChange:s=>C(s.target.value)}),a.isCustomizable&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-base sm:text-lg font-medium text-gray-700 mb-2",children:"Custom Fields"}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[a.customFields.map((s,o)=>e.jsxs("div",{className:"space-y-4 bg-gray-50 p-4 rounded-lg relative",children:[e.jsx("button",{type:"button",onClick:()=>P(o),className:"absolute top-2 right-2 text-red-500 hover:text-red-700",children:e.jsx(O,{className:"text-xl"})}),e.jsx(h,{label:"Custom Choice Name",value:s.fieldName,onChange:n=>E(o,"fieldName",n.target.value),placeholder:"Enter custom field name"}),e.jsx(h,{label:"Custom Choice Options",value:s.options,onChange:n=>E(o,"options",n.target.value),placeholder:"Enter options (comma separated)"}),e.jsx(h,{label:"Custom Choice Prices",value:s.price,onChange:n=>E(o,"price",n.target.value),placeholder:"Enter prices (comma separated)"})]},o)),e.jsx("button",{type:"button",onClick:N,className:"w-full sm:w-auto py-2 px-4 text-white bg-green-500 rounded-md hover:bg-green-600 transition-colors",children:"Add Custom Field"})]})]}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx(S,{text:m?e.jsx(ee,{size:10,color:"white"}):"Add Product",className:"w-full sm:w-auto py-3 px-8 text-lg sm:text-xl font-semibold text-white bg-orange-500 rounded-md hover:bg-orange-600 transition-colors",onClick:B})})]})]})]}),e.jsx(G,{children:g&&e.jsx(I.div,{className:"fixed top-0 left-0 right-0 bottom-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:e.jsxs(I.div,{className:"bg-white p-4 rounded-lg w-full max-w-md relative",initial:{scale:.8},animate:{scale:1},exit:{scale:.8},transition:{duration:.3},children:[e.jsx("button",{onClick:()=>b(!1),className:"absolute top-2 right-2 p-1 text-xl bg-red-500 text-white hover:bg-red-700 rounded-full",children:e.jsx(O,{})}),e.jsx(J,{className:"mt-6",ref:j,src:a.image,style:{height:300,width:"100%"},aspectRatio:1,guides:!1,cropBoxResizable:!1}),e.jsxs("div",{className:"mt-4 flex justify-between gap-4",children:[e.jsx("button",{onClick:q,className:"flex-1 py-2 px-4 text-white bg-gray-500 rounded-md hover:bg-gray-600 transition-colors",children:"Select New"}),e.jsx("button",{onClick:z,className:"flex-1 py-2 px-4 text-white bg-blue-500 rounded-md hover:bg-blue-600 transition-colors",children:"Done"})]})]})})})]})};export{de as default};
