import{r as t,P as b,j as e,m as o,a1 as z,a2 as B,E as N,a3 as V,B as n,a4 as H,a5 as Q,a6 as Z,a7 as G,a8 as J,a9 as K}from"./index-C0g0oOAM.js";import{a as v}from"./index-CdruDxZY.js";import{A as W}from"./AdminSearchBar-CU6sjleP.js";const se=()=>{const[m,p]=t.useState([]),[w,I]=t.useState(!1),[x,u]=t.useState({}),[D,f]=t.useState(!1),[l,g]=t.useState(null),[C,j]=t.useState(""),[d,y]=t.useState(1),[c,S]=t.useState(5),[M,R]=t.useState(!1),[i,O]=t.useState(null),[P,A]=t.useState(!1),_=async()=>{I(!0);try{const{data:s}=await V();if(s.success){const a=s.issues.map(r=>({...r,userName:r.username,email:r.userEmail,problemType:r.problemOn,refundAmount:r.refund||0}));p(a),n.success("Issues refreshed successfully")}}catch(s){console.error("Error fetching issues:",s),n.error("Failed to fetch issues")}finally{I(!1)}};t.useEffect(()=>{_()},[]);const E=async s=>{u(a=>({...a,[`resolve_${s}`]:!0}));try{(await H(s)).data.success&&(p(r=>r.filter(h=>h._id!==s)),n.success("Issue resolved successfully"))}catch(a){console.error("Error resolving issue:",a),n.error("Failed to resolve issue")}finally{u(a=>({...a,[`resolve_${s}`]:!1}))}},F=async s=>{u(a=>({...a,[`ignore_${s}`]:!0}));try{(await Q(s)).data.success&&(p(r=>r.filter(h=>h._id!==s)),n.success("Issue ignored successfully"))}catch(a){console.error("Error ignoring issue:",a),n.error("Failed to ignore issue")}finally{u(a=>({...a,[`ignore_${s}`]:!1}))}},$=s=>{g(s),j(s.refundAmount.toString()),f(!0)},T=async()=>{u(s=>({...s,refund:!0}));try{(await Z({userId:l.userId,refundAmt:Number(C),issueId:l._id})).data.success&&(n.success("Refund processed successfully"),f(!1),g(null),j(""),p(a=>a.filter(r=>r._id!==l._id)))}catch(s){console.error("Error processing refund:",s),n.error("Failed to process refund")}finally{u(s=>({...s,refund:!1}))}},U=s=>{navigator.clipboard.writeText(s).then(()=>n.success("Order ID copied!")).catch(()=>n.error("Failed to copy Order ID"))},q=async s=>{try{A(!0);const a=await K(s);a.data.success&&O(a.data.orderDetails)}catch(a){console.error("Error fetching order details:",a),n.error("Failed to fetch order details")}finally{A(!1)}},L=s=>{g(s),R(!0),q(s.orderId)},k=({issue:s,onClose:a})=>e.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:a,children:e.jsxs(o.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Order Details"}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(G,{className:"w-5 h-5 text-gray-500"})})]}),P?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Order ID:"}),e.jsx("span",{className:"text-gray-800",children:s.orderId}),e.jsx("button",{onClick:()=>U(s.orderId),className:"text-gray-500 hover:text-gray-700 transition-colors p-1 rounded-full hover:bg-gray-100",title:"Copy Order ID",children:e.jsx(J,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Restaurant:"}),e.jsx("span",{className:"ml-2 text-gray-800",children:i.restaurantName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Restaurant Address:"}),e.jsx("span",{className:"ml-2 text-gray-800",children:i.restaurantAddress})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Order Date:"}),e.jsx("span",{className:"ml-2 text-gray-800",children:i.orderDate})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Order Status:"}),e.jsx("span",{className:"ml-2 text-gray-800",children:i.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Items:"}),e.jsx("div",{className:"mt-2 space-y-2",children:i.items.map((r,h)=>e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 p-2 rounded",children:[e.jsxs("span",{className:"text-gray-800",children:[r.name," x",r.quantity]}),e.jsxs("span",{className:"text-gray-600",children:["₹",r.price*r.quantity]})]},h))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Total Amount:"}),e.jsxs("span",{className:"ml-2 text-gray-800",children:["₹",i.totalAmount.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Delivery Address:"}),e.jsx("p",{className:"mt-1 text-gray-800",children:i.deliveryAddress})]})]}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Failed to load order details"})]})});return k.propTypes={issue:b.shape({orderId:b.string.isRequired}).isRequired,onClose:b.func.isRequired},e.jsxs("div",{children:[e.jsx(W,{}),e.jsxs("div",{className:"flex justify-between items-center px-6 mb-6",children:[e.jsx("h2",{className:"text-4xl font-bold text-gray-800",children:"User Issues"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("select",{value:c,onChange:s=>{S(Number(s.target.value)),y(1)},className:"p-2 border border-gray-300 rounded-lg outline-none",children:[e.jsx("option",{value:5,children:"5 per page"}),e.jsx("option",{value:10,children:"10 per page"}),e.jsx("option",{value:20,children:"20 per page"})]}),e.jsxs(o.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:_,disabled:w,className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50",children:[e.jsx(z,{className:w?"animate-spin":"",size:20}),"Refresh"]})]})]}),m.length===0?e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex flex-col items-center justify-center p-8 ms-6",children:[e.jsx(B,{className:"text-7xl text-gray-300 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"No Issues Reported"}),e.jsx("p",{className:"text-gray-500 text-center",children:"There are currently no pending issues from users. Check back later"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 ms-6",children:e.jsx(N,{children:m.slice((d-1)*c,d*c).map(s=>e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},className:"bg-white rounded-lg shadow-lg p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:s.userName}),e.jsx("p",{className:"text-gray-600 text-sm",children:s.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Problem On:"}),e.jsx("span",{className:"ml-2 text-gray-800",children:s.problemType})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Description:"}),e.jsx("p",{className:"text-gray-800 mt-1",children:s.description})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Order ID:"}),e.jsx("span",{className:"ml-2 text-gray-800",children:s.orderId})]}),s.refundAmount>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 font-medium",children:"Requested Refund:"}),e.jsxs("span",{className:"ml-2 text-gray-800",children:["₹",s.refundAmount]})]})]}),s.orderId&&e.jsx(e.Fragment,{children:e.jsx("button",{onClick:()=>L(s),className:"flex-1 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:"View Order Details"})}),e.jsxs("div",{className:"flex space-x-3 mt-4",children:[e.jsx("button",{onClick:()=>E(s._id),disabled:x[`resolve_${s._id}`],className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:x[`resolve_${s._id}`]?e.jsx(v,{className:"animate-spin"}):"Resolve"}),s.refundAmount>0&&e.jsx("button",{onClick:()=>$(s),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Refund"}),e.jsx("button",{onClick:()=>F(s._id),disabled:x[`ignore_${s._id}`],className:"flex-1 px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:x[`ignore_${s._id}`]?e.jsx(v,{className:"animate-spin"}):"Ignore"})]})]},s._id))})}),Math.ceil(m.length/c)>1&&e.jsxs("div",{className:"flex justify-center gap-2 mt-6 mb-6",children:[e.jsx("button",{onClick:()=>y(s=>s-1),disabled:d===1,className:`px-3 py-1 rounded ${d===1?"bg-gray-200 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"}`,children:"Previous"}),[...Array(Math.ceil(m.length/c))].map((s,a)=>e.jsx("button",{onClick:()=>y(a+1),className:`px-3 py-1 rounded ${d===a+1?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-300"}`,children:a+1},a+1)),e.jsx("button",{onClick:()=>y(s=>s+1),disabled:d===Math.ceil(m.length/c),className:`px-3 py-1 rounded ${d===Math.ceil(m.length/c)?"bg-gray-200 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"}`,children:"Next"})]})]}),e.jsx(N,{children:D&&e.jsx(o.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(o.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Refund Details"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"User Name"}),e.jsx("p",{className:"font-medium",children:l==null?void 0:l.userName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:l==null?void 0:l.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-600 mb-1",children:"Refund Amount (₹)"}),e.jsx("input",{type:"number",value:C,onChange:s=>j(s.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",min:"0"})]}),e.jsxs("div",{className:"flex space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>f(!1),className:"flex-1 px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:T,disabled:x.refund,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:x.refund?e.jsx(v,{className:"animate-spin"}):"Add to User's Zcoin"})]})]})]})},"refund-modal")}),e.jsx(N,{children:M&&l&&e.jsx(k,{issue:l,onClose:()=>{R(!1),g(null),O(null)}})})]})};export{se as default};
